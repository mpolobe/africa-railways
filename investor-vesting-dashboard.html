<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Investment - ARAIL Vesting Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0.0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.0) 100%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); }
            50% { box-shadow: 0 0 40px rgba(0, 212, 255, 0.6); }
        }
        
        .glow-pulse {
            animation: pulse-glow 2s infinite;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function VestingDashboard() {
            const [walletConnected, setWalletConnected] = useState(false);
            const [walletAddress, setWalletAddress] = useState('');
            const [certificates, setCertificates] = useState([]);
            const [selectedCert, setSelectedCert] = useState(null);
            const [claiming, setClaiming] = useState(false);
            const [txStatus, setTxStatus] = useState('');

            // Smart Contract Configuration
            const PACKAGE_ID = "0x_YOUR_PACKAGE_ID_HERE";
            const SUI_PRICE = 1.44;

            // Demo data for testing
            const DEMO_CERTIFICATES = [
                {
                    id: '0x123abc...',
                    certificateNumber: 1,
                    suiInvested: 500,
                    equityTokens: 142857,
                    equityPercentage: 0.1429,
                    vestingStart: Date.now() - (90 * 24 * 60 * 60 * 1000), // 90 days ago
                    vestingEnd: Date.now() + (275 * 24 * 60 * 60 * 1000), // 275 days from now
                    totalClaimed: 35714,
                    investedAt: new Date(Date.now() - (90 * 24 * 60 * 60 * 1000)).toLocaleDateString(),
                },
                {
                    id: '0x456def...',
                    certificateNumber: 2,
                    suiInvested: 1000,
                    equityTokens: 285714,
                    equityPercentage: 0.2857,
                    vestingStart: Date.now() - (60 * 24 * 60 * 60 * 1000), // 60 days ago
                    vestingEnd: Date.now() + (305 * 24 * 60 * 60 * 1000), // 305 days from now
                    totalClaimed: 47619,
                    investedAt: new Date(Date.now() - (60 * 24 * 60 * 60 * 1000)).toLocaleDateString(),
                }
            ];

            useEffect(() => {
                if (walletConnected) {
                    // In production, query blockchain for user's certificates
                    setCertificates(DEMO_CERTIFICATES);
                    setSelectedCert(DEMO_CERTIFICATES[0]);
                }
            }, [walletConnected]);

            const connectWallet = async () => {
                try {
                    if (typeof window.suiWallet !== 'undefined') {
                        const accounts = await window.suiWallet.requestPermissions();
                        if (accounts && accounts.length > 0) {
                            setWalletConnected(true);
                            setWalletAddress(accounts[0]);
                            setTxStatus('Wallet connected! Loading your investments...');
                            setTimeout(() => setTxStatus(''), 3000);
                        }
                    } else {
                        // Demo mode
                        setWalletConnected(true);
                        setWalletAddress('0x72a1b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0');
                        setTxStatus('Demo Mode: Showing sample investments');
                        setTimeout(() => setTxStatus(''), 3000);
                    }
                } catch (error) {
                    console.error('Wallet connection error:', error);
                    setTxStatus('Failed to connect wallet');
                }
            };

            const calculateVestingProgress = (cert) => {
                const now = Date.now();
                const totalTime = cert.vestingEnd - cert.vestingStart;
                const elapsed = now - cert.vestingStart;
                
                if (elapsed >= totalTime) return 100;
                if (elapsed <= 0) return 0;
                
                return (elapsed / totalTime) * 100;
            };

            const calculateClaimable = (cert) => {
                const progress = calculateVestingProgress(cert);
                const vestedAmount = (cert.equityTokens * progress) / 100;
                return Math.max(0, Math.floor(vestedAmount - cert.totalClaimed));
            };

            const calculateTimeRemaining = (cert) => {
                const now = Date.now();
                const remaining = cert.vestingEnd - now;
                
                if (remaining <= 0) return 'Fully Vested';
                
                const days = Math.floor(remaining / (24 * 60 * 60 * 1000));
                const months = Math.floor(days / 30);
                
                if (months > 0) return `${months} month${months > 1 ? 's' : ''} remaining`;
                return `${days} day${days > 1 ? 's' : ''} remaining`;
            };

            const claimTokens = async () => {
                if (!selectedCert) return;
                
                setClaiming(true);
                setTxStatus('Preparing claim transaction...');

                try {
                    const claimable = calculateClaimable(selectedCert);
                    
                    if (claimable === 0) {
                        setTxStatus('No tokens available to claim yet');
                        setClaiming(false);
                        setTimeout(() => setTxStatus(''), 3000);
                        return;
                    }

                    setTxStatus('Awaiting wallet approval...');
                    
                    // Simulate transaction
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    const mockTxHash = '0x' + Math.random().toString(16).substring(2, 12);
                    setTxStatus(`‚úÖ Claimed ${claimable.toLocaleString()} tokens! TX: ${mockTxHash}...`);
                    
                    // Update certificate
                    const updatedCert = {
                        ...selectedCert,
                        totalClaimed: selectedCert.totalClaimed + claimable
                    };
                    setSelectedCert(updatedCert);
                    
                    const updatedCerts = certificates.map(c => 
                        c.id === selectedCert.id ? updatedCert : c
                    );
                    setCertificates(updatedCerts);
                    
                    setTimeout(() => {
                        setTxStatus('Tokens transferred to your wallet!');
                    }, 2000);
                } catch (error) {
                    console.error('Claim error:', error);
                    setTxStatus('‚ùå Claim failed. Please try again.');
                } finally {
                    setClaiming(false);
                    setTimeout(() => setTxStatus(''), 5000);
                }
            };

            const CircularProgress = ({ percentage, size = 200 }) => {
                const radius = (size - 20) / 2;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (percentage / 100) * circumference;

                return (
                    <svg width={size} height={size} className="progress-ring">
                        <circle
                            cx={size / 2}
                            cy={size / 2}
                            r={radius}
                            stroke="rgba(255, 255, 255, 0.1)"
                            strokeWidth="10"
                            fill="none"
                        />
                        <circle
                            className="progress-ring-circle"
                            cx={size / 2}
                            cy={size / 2}
                            r={radius}
                            stroke="url(#gradient)"
                            strokeWidth="10"
                            fill="none"
                            strokeDasharray={circumference}
                            strokeDashoffset={offset}
                            strokeLinecap="round"
                        />
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor="#00D4FF" />
                                <stop offset="100%" stopColor="#FFB800" />
                            </linearGradient>
                        </defs>
                        <text
                            x="50%"
                            y="50%"
                            textAnchor="middle"
                            dy=".3em"
                            className="text-4xl font-bold fill-white"
                        >
                            {percentage.toFixed(1)}%
                        </text>
                    </svg>
                );
            };

            if (!walletConnected) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="max-w-md w-full bg-slate-800 p-8 rounded-2xl border border-blue-700 text-center">
                            <div className="text-6xl mb-6">üé´</div>
                            <h1 className="text-3xl font-bold mb-4 text-white">My ARAIL Investment</h1>
                            <p className="text-slate-300 mb-8">
                                Connect your Sui Wallet to view your investment certificates and claim vested equity tokens.
                            </p>
                            <button
                                onClick={connectWallet}
                                className="w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-xl font-bold text-lg hover:scale-105 transition-transform"
                            >
                                Connect Sui Wallet
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 md:p-8">
                    {/* Header */}
                    <div className="max-w-7xl mx-auto mb-8">
                        <div className="bg-slate-800/50 backdrop-blur border border-blue-700 rounded-2xl p-6">
                            <div className="flex justify-between items-center flex-wrap gap-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-white mb-2">My Investments</h1>
                                    <p className="text-slate-400">
                                        Connected: {walletAddress.substring(0, 10)}...{walletAddress.substring(walletAddress.length - 8)}
                                    </p>
                                </div>
                                <div className="text-right">
                                    <div className="text-sm text-slate-400">Total Invested</div>
                                    <div className="text-2xl font-bold text-cyan-400">
                                        {certificates.reduce((sum, c) => sum + c.suiInvested, 0).toLocaleString()} SUI
                                    </div>
                                    <div className="text-sm text-slate-500">
                                        ${(certificates.reduce((sum, c) => sum + c.suiInvested, 0) * SUI_PRICE).toLocaleString()} USD
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto grid lg:grid-cols-3 gap-8">
                        {/* Certificate List */}
                        <div className="lg:col-span-1 space-y-4">
                            <h2 className="text-xl font-bold text-white mb-4">Investment Certificates</h2>
                            {certificates.map((cert) => (
                                <div
                                    key={cert.id}
                                    onClick={() => setSelectedCert(cert)}
                                    className={`p-4 rounded-xl cursor-pointer transition-all ${
                                        selectedCert?.id === cert.id
                                            ? 'bg-blue-900/50 border-2 border-cyan-400 glow-pulse'
                                            : 'bg-slate-800 border border-slate-700 hover:border-blue-600'
                                    }`}
                                >
                                    <div className="flex justify-between items-start mb-2">
                                        <div>
                                            <div className="text-xs text-slate-400">Certificate #{cert.certificateNumber}</div>
                                            <div className="text-lg font-bold text-white">{cert.suiInvested} SUI</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-xs text-slate-400">Equity</div>
                                            <div className="text-sm font-bold text-cyan-400">{cert.equityPercentage}%</div>
                                        </div>
                                    </div>
                                    <div className="w-full bg-slate-700 rounded-full h-2 mb-2">
                                        <div
                                            className="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full transition-all"
                                            style={{ width: `${calculateVestingProgress(cert)}%` }}
                                        />
                                    </div>
                                    <div className="text-xs text-slate-400">
                                        {calculateVestingProgress(cert).toFixed(1)}% vested
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Vesting Details */}
                        {selectedCert && (
                            <div className="lg:col-span-2 space-y-6">
                                {/* Status Message */}
                                {txStatus && (
                                    <div className={`p-4 rounded-xl text-center font-semibold ${
                                        txStatus.includes('‚úÖ') 
                                            ? 'bg-green-900/30 border border-green-600 text-green-400'
                                            : txStatus.includes('‚ùå')
                                            ? 'bg-red-900/30 border border-red-600 text-red-400'
                                            : 'bg-blue-900/30 border border-blue-600 text-blue-400'
                                    }`}>
                                        {txStatus}
                                    </div>
                                )}

                                {/* Vesting Progress Circle */}
                                <div className="bg-slate-800 p-8 rounded-2xl border border-blue-700">
                                    <h2 className="text-2xl font-bold text-white mb-6 text-center">Vesting Progress</h2>
                                    <div className="flex justify-center mb-6">
                                        <CircularProgress percentage={calculateVestingProgress(selectedCert)} />
                                    </div>
                                    <div className="text-center">
                                        <div className="text-slate-400 mb-2">{calculateTimeRemaining(selectedCert)}</div>
                                        <div className="text-sm text-slate-500">
                                            Invested on {selectedCert.investedAt}
                                        </div>
                                    </div>
                                </div>

                                {/* Token Details */}
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div className="bg-slate-800 p-6 rounded-2xl border border-blue-700">
                                        <div className="text-sm text-slate-400 mb-2">Total Equity Tokens</div>
                                        <div className="text-3xl font-bold text-white mb-1">
                                            {selectedCert.equityTokens.toLocaleString()}
                                        </div>
                                        <div className="text-sm text-cyan-400">
                                            {selectedCert.equityPercentage}% of ARAIL
                                        </div>
                                    </div>

                                    <div className="bg-slate-800 p-6 rounded-2xl border border-blue-700">
                                        <div className="text-sm text-slate-400 mb-2">Already Claimed</div>
                                        <div className="text-3xl font-bold text-white mb-1">
                                            {selectedCert.totalClaimed.toLocaleString()}
                                        </div>
                                        <div className="text-sm text-slate-500">
                                            {((selectedCert.totalClaimed / selectedCert.equityTokens) * 100).toFixed(1)}% of total
                                        </div>
                                    </div>
                                </div>

                                {/* Claimable Tokens */}
                                <div className="bg-gradient-to-br from-blue-900/50 to-cyan-900/50 p-8 rounded-2xl border-2 border-cyan-400">
                                    <div className="text-center mb-6">
                                        <div className="text-sm text-cyan-300 mb-2">Available to Claim Now</div>
                                        <div className="text-5xl font-black text-white mb-2">
                                            {calculateClaimable(selectedCert).toLocaleString()}
                                        </div>
                                        <div className="text-sm text-slate-300">
                                            Equity Tokens
                                        </div>
                                    </div>

                                    <button
                                        onClick={claimTokens}
                                        disabled={claiming || calculateClaimable(selectedCert) === 0}
                                        className={`w-full py-5 rounded-xl font-black text-lg transition-all ${
                                            claiming || calculateClaimable(selectedCert) === 0
                                                ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                                                : 'bg-gradient-to-r from-blue-600 to-cyan-500 hover:scale-105 shadow-xl'
                                        }`}
                                    >
                                        {claiming 
                                            ? '‚è≥ CLAIMING...' 
                                            : calculateClaimable(selectedCert) === 0
                                            ? 'NO TOKENS AVAILABLE YET'
                                            : `CLAIM ${calculateClaimable(selectedCert).toLocaleString()} TOKENS`}
                                    </button>

                                    <div className="mt-4 text-xs text-center text-slate-400">
                                        <i className="fas fa-info-circle mr-1"></i>
                                        Tokens unlock linearly over 12 months. Check back daily to claim more.
                                    </div>
                                </div>

                                {/* Investment Details */}
                                <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                                    <h3 className="text-lg font-bold text-white mb-4">Investment Details</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className="text-slate-400">Certificate ID</span>
                                            <span className="text-white font-mono text-sm">{selectedCert.id}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-slate-400">SUI Invested</span>
                                            <span className="text-white font-bold">{selectedCert.suiInvested} SUI</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-slate-400">USD Value (at investment)</span>
                                            <span className="text-white">${(selectedCert.suiInvested * SUI_PRICE).toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-slate-400">Vesting Start</span>
                                            <span className="text-white">{new Date(selectedCert.vestingStart).toLocaleDateString()}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-slate-400">Vesting End</span>
                                            <span className="text-white">{new Date(selectedCert.vestingEnd).toLocaleDateString()}</span>
                                        </div>
                                        <div className="flex justify-between pt-3 border-t border-slate-700">
                                            <span className="text-cyan-400 font-bold">Your Equity</span>
                                            <span className="text-cyan-400 font-bold">{selectedCert.equityPercentage}%</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Auto-Staking Info */}
                                <div className="bg-gradient-to-r from-yellow-900/30 to-orange-900/30 p-6 rounded-2xl border border-yellow-600/50">
                                    <div className="flex items-start gap-4">
                                        <div className="text-3xl">üí∞</div>
                                        <div>
                                            <h3 className="text-lg font-bold text-yellow-400 mb-2">Treasury Auto-Staking</h3>
                                            <p className="text-sm text-slate-300 mb-2">
                                                Your invested SUI is automatically staked to Sui validators, generating ~2-4% APY. 
                                                This yield funds operational costs (servers, SMS gateway) while your principal remains secure.
                                            </p>
                                            <div className="text-xs text-slate-400">
                                                <i className="fas fa-shield-alt mr-1"></i>
                                                Your equity is protected. Staking rewards go to operations, not dilution.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VestingDashboard />);
    </script>
</body>
</html>
