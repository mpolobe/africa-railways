#!/bin/bash

# ğŸš€ Build Both Apps - Railways and Africoin

set -e

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  ğŸš€ Building Both Apps - Railways & Africoin              â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Check if eas-cli is available
if ! command -v eas &> /dev/null; then
    echo "ğŸ“¦ Installing EAS CLI..."
    npm install -g eas-cli
fi

# Login check
echo "ğŸ” Checking authentication..."
if ! eas whoami &> /dev/null; then
    echo "Please login to Expo:"
    eas login
fi

echo ""
echo "You can build both apps:"
echo "  1) Sequential (one after another)"
echo "  2) Parallel (both at once)"
echo ""
read -p "Choose option (1 or 2): " BUILD_OPTION

if [ "$BUILD_OPTION" = "1" ]; then
    echo ""
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘  ğŸš‚ Building Railways App First                           â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    
    eas build --platform android --profile railways --non-interactive
    
    echo ""
    echo "âœ… Railways build started!"
    echo ""
    read -p "Press Enter to start Africoin build..."
    
    echo ""
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘  ğŸ’° Building Africoin App                                 â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    
    eas build --platform android --profile africoin --non-interactive
    
    echo ""
    echo "âœ… Africoin build started!"
    
elif [ "$BUILD_OPTION" = "2" ]; then
    echo ""
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘  ğŸš€ Building Both Apps in Parallel                        â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    
    echo "ğŸš‚ Starting Railways build..."
    eas build --platform android --profile railways --non-interactive &
    RAILWAYS_PID=$!
    
    sleep 5
    
    echo "ğŸ’° Starting Africoin build..."
    eas build --platform android --profile africoin --non-interactive &
    AFRICOIN_PID=$!
    
    echo ""
    echo "âœ… Both builds started!"
    echo "   Railways PID: $RAILWAYS_PID"
    echo "   Africoin PID: $AFRICOIN_PID"
    
else
    echo "âŒ Invalid option"
    exit 1
fi

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  âœ… Build(s) Triggered!                                    â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Monitor your builds:"
echo ""
echo "ğŸš‚ Railways:"
echo "   https://expo.dev/accounts/mpolobe/projects/africa-railways/builds"
echo ""
echo "ğŸ’° Africoin:"
echo "   https://expo.dev/accounts/mpolobe/projects/africoin-app/builds"
echo ""
echo "GitHub Actions:"
echo "   https://github.com/mpolobe/africa-railways/actions"
echo ""
echo "â±ï¸  Expected time: 20-30 minutes per app"
echo ""
